<!DOCTYPE html>

<html>
	<head>
		<meta charset="UTF-8">
		<title>luojialun</title>
		<link rel="stylesheet" href="style.css">
	</head>
	<body>
		<script src="jquery.js"></script>
    <script type="text/javascript" src="utils.js" id="link_data_proxy_utils"></script>

		<div class="header">
			<h1>誠意伯文集序</h1>
		</div>
		<div class="content">國初誠意伯劉公伯温嘗著郁離子五巻覆瓿集并拾遺二十巻犂眉公集五巻寫情集暨春秋明經各四巻其孫廌集御書及狀序諸作曰翊運録皆鋟梓行世然諸集渙而無統板畫久而寖湮學者病之巡浙御史戴君用與其寀薛君謙楊君琅謀重鋟廼録善本次第諸集而冠以翊運録俾杭郡守張君僖成之屬守陳序維公以命世豪傑之才出佐我高皇剪羣雄混六合讜言谹議牖道天𠂻偉略竒謀指授羣帥者鼎彞勒之汗青書之四方尚能道之方其未遇也鬱積感憤發之文辭若四嶽之出雲無窮若公輸之營衆宇各盡其制若孫武子之師戈甲蔽野而不聞喑嗚叱咤之聲若大海浩溔中畜虬螭䱎䲛之屬覩者眙而莫能名然皆載道之航輪濟
  	</div>
    
    
        <input type='button' id="term" value='泡沫'>
<script>
    
    $("#term").click(function () {
        var term_value = this.value;
        $.getJSON("http://localhost:8000/add_term?callback=?", {term: term_value, cache_id: cache_id}, function(result) {

        });
        $.getJSON("http://exp-linked-data-proxy-2017.dlll.nccu.edu.tw/add_term?callback=?", {term: term_value, cache_id: cache_id}, function(result) {

        });
    });


</script>

<script>


var iframe_post = function (_url, _data, _callback) {
    
    var _DEBUG = false;
    
    if (typeof(_data) === "function" && typeof(_callback) === "undefined") {
        _callback = _data;
        _data = {};
    }
    else if (typeof(_data) === "undefined") {
        _data = {};
    }
    
    var _id = "iframe_post" + (new Date()).getTime();
    var _body = $("body");
    var _form = $('<form action="' + _url + '" method="post" target="' + _id +  '"></form>')
            .hide().appendTo(_body);
    var _iframe = $('<iframe name="' + _id + '"></iframe>')
            .hide()
            .appendTo(_body);
    if (_DEBUG === true) {
        _iframe.show();
    }
    
    for (var _key in _data) {
        var _value = _data[_key];
        
        $('<input type="hidden" name="' + _key + '" value="' + _value + '" />')
                .appendTo(_form);
    }
    
    _iframe.bind("load", function () {
        setTimeout(function () {
            if (_DEBUG !== true) {
                _iframe.remove();
            }
            
            if (typeof(_callback) === "function") {
                _callback();
            }
        }, 100);
    });
    
    setTimeout(function () {
        _form.submit();
    }, 100);
    
};

var selector="div.content";
var content=$(selector).html();

/*
$.getJSON("http://localhost:8000?callback=?", {article: content}, function(result) {
		console.log(result);
		$(selector).html(result);
});
*/
cache_id = undefined;
iframe_post("http://localhost:8000/parse_article", {article: content}, function(result) {

    var _retry = function () {
      $.getJSON("http://localhost:8000/parse_article?callback=?", function (data) {
          if (data === null) {
            setTimeout(function () {
              console.log("再次查詢");
              _retry();
            }, 3000);
            return;
          }

          var result = data.result;
          cache_id = data.cache_id;
          if (result === undefined || result === null) {
            setTimeout(function () {
              console.log("再次查詢");
              _retry();
            }, 3000);
            return;
          }
          else {
            console.log(result);
            $(selector).html(result);
          }
      });
    };

    setTimeout(function () {
        _retry();
    }, 100);
});




  	</script>

    <script>


      $("#check").submit(function () {
        $("#check_result").html("Loading...");
        
        var _query = $("#check_query").val().trim();
        var _modules = [];
        $("input[name='check_module']:checked").each(function (i, ele) {
            _modules.push(ele.value);
        });
        
        LINK_DATA_PROXY.check(_query, _modules, function (_result) {
            $("#check_result").html(_result.join(" "));
        });
        return false;
    });


    $(document).ready(function () {
    $(document).on('click', '.vocabulary.tooltip', function () {
        var ts=$(this).text();
        var pop;
        var _result = $("#result").empty();
        _result.html("Loading...");
      $.getJSON("http://exp-linked-data-proxy-2017.dlll.nccu.edu.tw/wiki,moedict,cbdb,tgaz,cdict,pixabay/"+ts+"?callback=?", function (_data) {
          $("#result").empty();
            for (var _i = 0; _i < _data.length; _i++) {
                var _d = _data[_i];
                var _module = _d.module;
                if (typeof(_d.response) === "string") {
                    var _response = _d.response;
                    _result.append($("<fieldset><legend>" + _module + "</legend>" + _response + "</fieldset>"));
                }
            }
        
      });
    });
});
    </script>
  
 <span class="vocabulary tooltip">
    誠意伯<span class="popuptext">劉基（1311年7月1日－1375年5月16日），字伯溫，浙江青田人，祖籍陝西保安（志丹），南宋抗金將領劉光世的後人。元末明初軍事家、政治家及詩人，通經史、曉天文、精兵法。他以輔佐明太祖朱元璋完成帝業、開創明朝並保持國家安定，因而馳名天下，被後人比作爲諸葛武侯。朱元璋多次稱劉基為：「吾之子房也。」授資善大夫、上護軍，封誠意伯。正德時追贈太師，諡文成。</span>
  </span>
  <div id="result"></div>
	</body>
</html>

